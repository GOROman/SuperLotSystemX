// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// キャンペーン参加者
model Participant {
  id         String    @id @default(uuid())
  userId     String    @unique // Twitter ID
  screenName String // Twitter スクリーンネーム
  isFollower Boolean   @default(false)
  isEligible Boolean   @default(false) // 応募条件を満たしているか
  isWinner   Boolean   @default(false) // 当選したか
  giftCode   String? // Amazonギフト券コード
  notifiedAt DateTime? // 当選通知送信日時
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  retweets   Retweet[] // リツイート情報

  @@index([isFollower, isEligible, isWinner])
}

// リツイート情報
model Retweet {
  id            String      @id @default(uuid())
  tweetId       String // 対象ツイートID
  participantId String
  participant   Participant @relation(fields: [participantId], references: [id])
  retweetedAt   DateTime    @default(now())

  @@unique([participantId, tweetId])
  @@index([tweetId])
}

// キャンペーン設定
model Campaign {
  id          String   @id @default(uuid())
  name        String // キャンペーン名
  description String // 説明
  startDate   DateTime // 開始日時
  endDate     DateTime // 終了日時
  winnerCount Int // 当選者数
  giftAmount  Int // ギフト券金額
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tweets      Tweet[] // 対象ツイート

  @@index([isActive])
}

// キャンペーンの対象ツイート
model Tweet {
  id         String   @id @default(uuid())
  tweetId    String // TwitterのツイートID
  campaignId String
  campaign   Campaign @relation(fields: [campaignId], references: [id])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([campaignId, tweetId])
  @@index([tweetId])
}
